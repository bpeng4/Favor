model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, "Microbiome", console = TRUE)
duncan_result <- duncan.test(model, "Seed_Name", console = TRUE)
#Order the samples
sample_order <- c( "PHG47", "764", "PHG35", "NC262", "LH60", "HP301",
"B57",  "A554", "PHG39", "FBB0")
set1sub <- set1sub %>%
filter(Seed_Name %in% sample_order) %>%
mutate(Seed_Name = factor(Seed_Name, levels = sample_order)) %>%
arrange(Seed_Name)
#Duncan Test for the sub-microbiome
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, c("Seed_Name", "Microbiome"), console = TRUE)
#Prepare grouping labels
symbols <- duncan_result[6] |> as.data.frame()
symbols$Sample <- rownames(symbols)
symbols <- symbols %>%
separate(Sample, into = c("Seed", "Microbiome"), sep = ":")
microbiome_order <- c()
symbols <- symbols %>%
mutate(
Seed = factor(Seed, levels = sample_order),
Microbiome = factor(Microbiome, levels = microbiome_order)
) %>%
arrange(Seed, Microbiome)
## Summarizing data and Plotting
bar_data <- set1sub %>%
group_by(Seed_Name, Microbiome) %>%
summarise(log2 = mean(log2), .groups = "drop") %>%
mutate(group_label = symbols$groups.groups)
subcolors <- c('#7FC97F', '#1CF7C2', '#E9A971')
ggplot(bar_data, aes(x = Seed_Name, y = log2, fill = Microbiome)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
scale_fill_manual(values = subcolors) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid.major.x = element_blank(),
legend.title = element_blank()
) +
ggtitle("S2 S17 S19") +
scale_y_break(c(1, 10), scales = 300) +
labs(y = "Bifidobacteria (Log2(CFU))", x = "Sample Type") +
geom_text(
aes(label = group_label),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3.5
)
# Fifth Set
#Subset Microbiomes
set1sub <- set1[set1$Microbiome %in% c("S1","S3", "S4","S7"),]
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, "Microbiome", console = TRUE)
duncan_result <- duncan.test(model, "Seed_Name", console = TRUE)
#Order the samples
sample_order <- c( "764", "PHG39","PHG47", "B57", "PHG35", "A554", "NC262",
"LH60", "HP301", "FBB0")
set1sub <- set1sub %>%
filter(Seed_Name %in% sample_order) %>%
mutate(Seed_Name = factor(Seed_Name, levels = sample_order)) %>%
arrange(Seed_Name)
#Duncan Test for the sub-microbiome
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, c("Seed_Name", "Microbiome"), console = TRUE)
#Prepare grouping labels
symbols <- duncan_result[6] |> as.data.frame()
symbols$Sample <- rownames(symbols)
symbols <- symbols %>%
separate(Sample, into = c("Seed", "Microbiome"), sep = ":")
microbiome_order <- c("S1","S3", "S4","S7")
symbols <- symbols %>%
mutate(
Seed = factor(Seed, levels = sample_order),
Microbiome = factor(Microbiome, levels = microbiome_order)
) %>%
arrange(Seed, Microbiome)
## Summarizing data and Plotting
bar_data <- set1sub %>%
group_by(Seed_Name, Microbiome) %>%
summarise(log2 = mean(log2), .groups = "drop") %>%
mutate(group_label = symbols$groups.groups)
subcolors <- c('#F781BF', '#FF7F00', '#8DD3C7', '#E41A1C')
ggplot(bar_data, aes(x = Seed_Name, y = log2, fill = Microbiome)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
scale_fill_manual(values = subcolors) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid.major.x = element_blank(),
legend.title = element_blank()
) +
ggtitle("S1 S3 S4 S7") +
scale_y_break(c(1, 10), scales = 300) +
labs(y = "Bifidobacteria (Log2(CFU))", x = "Sample Type") +
geom_text(
aes(label = group_label),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3.5
)
# Fifth Set
#Subset Microbiomes
set1sub <- set1[set1$Microbiome %in% c("S1","S3", "S7"),]
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, "Microbiome", console = TRUE)
duncan_result <- duncan.test(model, "Seed_Name", console = TRUE)
#Order the samples
sample_order <- c( "764", "PHG39","PHG47", "B57", "PHG35", "LH60", "A554",
"NC262", "HP301", "FBB0")
set1sub <- set1sub %>%
filter(Seed_Name %in% sample_order) %>%
mutate(Seed_Name = factor(Seed_Name, levels = sample_order)) %>%
arrange(Seed_Name)
#Duncan Test for the sub-microbiome
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, c("Seed_Name", "Microbiome"), console = TRUE)
#Prepare grouping labels
symbols <- duncan_result[6] |> as.data.frame()
symbols$Sample <- rownames(symbols)
symbols <- symbols %>%
separate(Sample, into = c("Seed", "Microbiome"), sep = ":")
microbiome_order <- c("S1","S3", "S7")
symbols <- symbols %>%
mutate(
Seed = factor(Seed, levels = sample_order),
Microbiome = factor(Microbiome, levels = microbiome_order)
) %>%
arrange(Seed, Microbiome)
## Summarizing data and Plotting
bar_data <- set1sub %>%
group_by(Seed_Name, Microbiome) %>%
summarise(log2 = mean(log2), .groups = "drop") %>%
mutate(group_label = symbols$groups.groups)
subcolors <- c('#F781BF', '#FF7F00', '#E41A1C')
ggplot(bar_data, aes(x = Seed_Name, y = log2, fill = Microbiome)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
scale_fill_manual(values = subcolors) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid.major.x = element_blank(),
legend.title = element_blank()
) +
ggtitle("S1 S3 S4 S7") +
scale_y_break(c(1, 10), scales = 300) +
labs(y = "Bifidobacteria (Log2(CFU))", x = "Sample Type") +
geom_text(
aes(label = group_label),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3.5
)
#First Set "S9 S15 S18 S21"
#Subset Microbiomes
set1sub <- set1[set1$Microbiome %in% c("S9", "S15", "S18", "S21"),]
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, "Microbiome", console = TRUE)
duncan_result <- duncan.test(model, "Seed_Name", console = TRUE)
#Order the samples
sample_order <- c( "LH60", "PHG47", "NC262", "B57", "HP301", "PHG39", "A554",
"764", "PHG35",  "FBB0")
set1sub <- set1sub %>%
filter(Seed_Name %in% sample_order) %>%
mutate(Seed_Name = factor(Seed_Name, levels = sample_order)) %>%
arrange(Seed_Name)
#Duncan Test for the sub-microbiome
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, c("Seed_Name", "Microbiome"), console = TRUE)
#Prepare grouping labels
symbols <- duncan_result[6] |> as.data.frame()
symbols$Sample <- rownames(symbols)
symbols <- symbols %>%
separate(Sample, into = c("Seed", "Microbiome"), sep = ":")
microbiome_order <- c("S9","S15","S18", "S21")
symbols <- symbols %>%
mutate(
Seed = factor(Seed, levels = sample_order),
Microbiome = factor(Microbiome, levels = microbiome_order)
) %>%
arrange(Seed, Microbiome)
## Summarizing data and Plotting
bar_data <- set1sub %>%
group_by(Seed_Name, Microbiome) %>%
summarise(log2 = mean(log2), .groups = "drop") %>%
mutate(group_label = symbols$groups.groups)
subcolors <- c('#386CB0', '#FFC300', '#9F4004','#86940f')
ggplot(bar_data, aes(x = Seed_Name, y = log2, fill = Microbiome)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
scale_fill_manual(values = subcolors) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid.major.x = element_blank(),
legend.title = element_blank()
) +
ggtitle("S9 S15 S18 S21") +
scale_y_break(c(1, 10), scales = 300) +
labs(y = "Bifidobacteria (Log2(CFU))", x = "Sample Type") +
geom_text(
aes(label = group_label),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3.5
)
#Second Set "S5 S14 S20 S24"
#Subset Microbiomes
set1sub <- set1[set1$Microbiome %in% c("S20","S5","S14", "S24"),]
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, "Microbiome", console = TRUE)
duncan_result <- duncan.test(model, "Seed_Name", console = TRUE)
#Order the samples
sample_order <- c( "PHG47", "764", "NC262", "B57", "PHG35", "HP301",
"PHG39", "LH60", "A554", "FBB0")
set1sub <- set1sub %>%
filter(Seed_Name %in% sample_order) %>%
mutate(Seed_Name = factor(Seed_Name, levels = sample_order)) %>%
arrange(Seed_Name)
#Duncan Test for the sub-microbiome
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, c("Seed_Name", "Microbiome"), console = TRUE)
#Prepare grouping labels
symbols <- duncan_result[6] |> as.data.frame()
symbols$Sample <- rownames(symbols)
symbols <- symbols %>%
separate(Sample, into = c("Seed", "Microbiome"), sep = ":")
microbiome_order <- c("S5","S14", "S20", "S24")
symbols <- symbols %>%
mutate(
Seed = factor(Seed, levels = sample_order),
Microbiome = factor(Microbiome, levels = microbiome_order)
) %>%
arrange(Seed, Microbiome)
## Summarizing data and Plotting
bar_data <- set1sub %>%
group_by(Seed_Name, Microbiome) %>%
summarise(log2 = mean(log2), .groups = "drop") %>%
mutate(group_label = symbols$groups.groups)
subcolors <- c('#999999', '#ce9032', '#1132F0', '#a48cf4')
ggplot(bar_data, aes(x = Seed_Name, y = log2, fill = Microbiome)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
scale_fill_manual(values = subcolors) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid.major.x = element_blank(),
legend.title = element_blank()
) +
ggtitle("S5 S14 S20 S24") +
scale_y_break(c(1, 10), scales = 300) +
labs(y = "Bifidobacteria (Log2(CFU))", x = "Sample Type") +
geom_text(
aes(label = group_label),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3.5
)
# Third Set "S6","S12", "S16","S22"
#Subset Microbiomes
set1sub <- set1[set1$Microbiome %in% c("S6","S12", "S16","S22"),]
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, "Microbiome", console = TRUE)
duncan_result <- duncan.test(model, "Seed_Name", console = TRUE)
#Order the samples
sample_order <- c( "HP301", "PHG47", "PHG35", "764", "NC262", "A554", "PHG39",
"B57", "LH60", "FBB0")
set1sub <- set1sub %>%
filter(Seed_Name %in% sample_order) %>%
mutate(Seed_Name = factor(Seed_Name, levels = sample_order)) %>%
arrange(Seed_Name)
#Duncan Test for the sub-microbiome
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, c("Seed_Name", "Microbiome"), console = TRUE)
#Prepare grouping labels
symbols <- duncan_result[6] |> as.data.frame()
symbols$Sample <- rownames(symbols)
symbols <- symbols %>%
separate(Sample, into = c("Seed", "Microbiome"), sep = ":")
microbiome_order <- c("S6 S12 S16 S22")
symbols <- symbols %>%
mutate(
Seed = factor(Seed, levels = sample_order),
Microbiome = factor(Microbiome, levels = microbiome_order)
) %>%
arrange(Seed, Microbiome)
## Summarizing data and Plotting
bar_data <- set1sub %>%
group_by(Seed_Name, Microbiome) %>%
summarise(log2 = mean(log2), .groups = "drop") %>%
mutate(group_label = symbols$groups.groups)
subcolors <- c('#CAB2D6', '#f7754f', '#B429DC', '#3ca2f4')
ggplot(bar_data, aes(x = Seed_Name, y = log2, fill = Microbiome)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
scale_fill_manual(values = subcolors) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid.major.x = element_blank(),
legend.title = element_blank()
) +
ggtitle("S6 S12 S16 S22") +
scale_y_break(c(1, 10), scales = 300) +
labs(y = "Bifidobacteria (Log2(CFU))", x = "Sample Type") +
geom_text(
aes(label = group_label),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3.5
)
#Fourth Set "S2","S19","S17"
#Subset Microbiomes
set1sub <-set1[set1$Microbiome %in% c("S2","S19","S17"),]
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, "Microbiome", console = TRUE)
duncan_result <- duncan.test(model, "Seed_Name", console = TRUE)
#Order the samples
sample_order <- c( "PHG47", "764", "PHG35", "NC262", "LH60", "HP301",
"B57",  "A554", "PHG39", "FBB0")
set1sub <- set1sub %>%
filter(Seed_Name %in% sample_order) %>%
mutate(Seed_Name = factor(Seed_Name, levels = sample_order)) %>%
arrange(Seed_Name)
#Duncan Test for the sub-microbiome
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, c("Seed_Name", "Microbiome"), console = TRUE)
#Prepare grouping labels
symbols <- duncan_result[6] |> as.data.frame()
symbols$Sample <- rownames(symbols)
symbols <- symbols %>%
separate(Sample, into = c("Seed", "Microbiome"), sep = ":")
microbiome_order <- c()
symbols <- symbols %>%
mutate(
Seed = factor(Seed, levels = sample_order),
Microbiome = factor(Microbiome, levels = microbiome_order)
) %>%
arrange(Seed, Microbiome)
## Summarizing data and Plotting
bar_data <- set1sub %>%
group_by(Seed_Name, Microbiome) %>%
summarise(log2 = mean(log2), .groups = "drop") %>%
mutate(group_label = symbols$groups.groups)
subcolors <- c('#7FC97F', '#1CF7C2', '#E9A971')
ggplot(bar_data, aes(x = Seed_Name, y = log2, fill = Microbiome)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
scale_fill_manual(values = subcolors) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid.major.x = element_blank(),
legend.title = element_blank()
) +
ggtitle("S2 S17 S19") +
scale_y_break(c(1, 10), scales = 300) +
labs(y = "Bifidobacteria (Log2(CFU))", x = "Sample Type") +
geom_text(
aes(label = group_label),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3.5
)
# Fifth Set
#Subset Microbiomes
set1sub <- set1[set1$Microbiome %in% c("S1","S3", "S7"),]
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, "Microbiome", console = TRUE)
duncan_result <- duncan.test(model, "Seed_Name", console = TRUE)
#Order the samples
sample_order <- c( "764", "PHG39","PHG47", "B57", "PHG35", "LH60", "A554",
"NC262", "HP301", "FBB0")
set1sub <- set1sub %>%
filter(Seed_Name %in% sample_order) %>%
mutate(Seed_Name = factor(Seed_Name, levels = sample_order)) %>%
arrange(Seed_Name)
#Duncan Test for the sub-microbiome
model <- aov(CFU ~ Seed_Name*Microbiome, data = set1sub)
summary(model)
duncan_result <- duncan.test(model, c("Seed_Name", "Microbiome"), console = TRUE)
#Prepare grouping labels
symbols <- duncan_result[6] |> as.data.frame()
symbols$Sample <- rownames(symbols)
symbols <- symbols %>%
separate(Sample, into = c("Seed", "Microbiome"), sep = ":")
microbiome_order <- c("S1","S3", "S7")
symbols <- symbols %>%
mutate(
Seed = factor(Seed, levels = sample_order),
Microbiome = factor(Microbiome, levels = microbiome_order)
) %>%
arrange(Seed, Microbiome)
## Summarizing data and Plotting
bar_data <- set1sub %>%
group_by(Seed_Name, Microbiome) %>%
summarise(log2 = mean(log2), .groups = "drop") %>%
mutate(group_label = symbols$groups.groups)
subcolors <- c('#F781BF', '#FF7F00', '#E41A1C')
ggplot(bar_data, aes(x = Seed_Name, y = log2, fill = Microbiome)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
scale_fill_manual(values = subcolors) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid.major.x = element_blank(),
legend.title = element_blank()
) +
ggtitle("S1 S3 S7") +
scale_y_break(c(1, 10), scales = 300) +
labs(y = "Bifidobacteria (Log2(CFU))", x = "Sample Type") +
geom_text(
aes(label = group_label),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3.5
)
library(GGally)
B_Species <- read.csv(file = "/Users/bopeng/Documents/Favor/Cache/Bifido_Species_RA.csv")
B_Species_Long <- reshape(B_Species, direction = "long",
varying = c("B.gallicum","B.catenulatum","B.breve",
"B.adolescentis","B.bifidum","B.NA1",
"B.NA2", "B.NA3","B.NA4", "B.NA5",
"B.NA6","B.NA7","B.NA8"),
timevar = "Species", idvar = "Sample_Name")
library(GGally)
B_Species <- read.csv(file = "/Users/bopeng/Documents/Favor/Cache/otu.all.csv")
B_Species <- read.csv(file = "/Users/bopeng/Documents/Favor/Cache/otu.all.csv")
B_Species <- read.csv(file = "/Users/bopeng/Documents/Favor/Cache/otu.all.csv")
library(ggplot2)
library(dplyr)
library(ggrepel)
library(broom)
#### Bifidobacterium
Bifi_Genus <- read.csv(file = "/Users/bopeng/Documents/Favor/Cache/Bifidobacterium_Genus.csv")
Bifi_Genus$Bifi_log2 <- log(Bifi_Genus$Bifidobacterium, base = 2)
#### Bacteroides
Bac_Genus <- read.csv(file = "/Users/bopeng/Documents/Favor/Cache/Bacteroides_Genus.csv")
Bac_Genus$Bac_log10 <- log10(Bac_Genus$Bacteroides)
#### Bif_Bac
Bac_Bif_Genus <- merge(Bifi_Genus, Bac_Genus, by=c("Sample_Name", "Seed_Type"))
#### Remove Samples with "-Inf" Bifidobacterium values
Bac_Bif_Genus <- Bac_Bif_Genus[Bac_Bif_Genus$Bifi_log2 != "-Inf",]
#### Scatter Plot
# Load required libraries
library(ggplot2)
library(dplyr)
library(ggrepel)
library(broom)
library(purrr)  # Needed for map_dbl and map2_dbl
# Optional: for reproducible label layout
set.seed(123)
# Step 1: Calculate R² and Spearman ρ per Seed_Type
model_info <- Bac_Bif_Genus %>%
group_by(Seed_Type) %>%
summarise(
# Fit linear model
mod = list(lm(Bifi_log2 ~ Bac_log10, data = pick(everything()))),
# Spearman correlation
spearman_rho = cor(Bac_log10, Bifi_log2, method = "spearman", use = "complete.obs"),
# Mean x for label position
x = mean(Bac_log10, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(
# Extract R²
r2 = map_dbl(mod, ~ glance(.x)$r.squared),
# Predict y at mean x
y = map2_dbl(mod, x, ~ predict(.x, newdata = data.frame(Bac_log10 = .y))),
# Construct label
label = paste0(Seed_Type, "\nR² = ", round(r2, 2), "\nρ = ", round(spearman_rho, 2))
)
# Step 2: Plot with labels
ggplot(Bac_Bif_Genus, aes(x = Bac_log10, y = Bifi_log2, color = Seed_Type)) +
geom_point(alpha = 0.6) +
geom_smooth(method = "lm", se = FALSE, linewidth = 1) +
geom_label_repel(
data = model_info,
aes(x = x, y = y, label = label, fill = Seed_Type),
color = "black", show.legend = FALSE,
size = 3, label.size = 0.3,
max.overlaps = 100
) +
theme_bw() +
guides(color = 'none', fill = 'none') +
labs(x = "Bacteroides (log10)", y = "Bifidobacterium (log2)")
# Step 2: Plot with labels
ggplot(Bac_Bif_Genus, aes(x = Bac_log10, y = Bifi_log2, color = Seed_Type)) +
geom_point(alpha = 0.6) +
geom_smooth(method = "lm", se = FALSE, linewidth = 1) +
geom_label_repel(
data = model_info,
aes(x = x, y = y, label = label, fill = Seed_Type),
color = "black", show.legend = FALSE,
size = 3, label.size = 0.3,
max.overlaps = 100
) +
theme_bw() +
guides(color = 'none', fill = 'none') +
labs(x = "Bacteroides (log10(CFU))", y = "Bifidobacterium (log2(CFU))")
